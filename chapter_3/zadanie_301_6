WITH DAILY_SALES AS (
	SELECT SALES_TRANSACTION_DATE::DATE,
	SUM(SALES_AMOUNT) AS TOTAL_SALES
	FROM SALES
	GROUP BY 1
),
SALES_STATS_30 AS (
	SELECT SALES_TRANSACTION_DATE, TOTAL_SALES, MAX(TOTAL_SALES)
	OVER (ORDER BY SALES_TRANSACTION_DATE ROWS BETWEEN 30 PRECEDING AND 1 PRECEDING ) AS MAX_SALES_30
FROM DAILY_SALES
ORDER BY 1)

SELECT SALES_TRANSACTION_DATE, TOTAL_SALES, MAX_SALES_30
FROM SALES_STATS_30
WHERE SALES_TRANSACTION_DATE>='2019-01-01';